# MyHttp

# HTTP基础

## 1.HTTP概述

### 本章问题
1. WEB客户端和服务器是如何通信的
2. 表示web内容的资源来自何方
3. web事务是怎样工作的
4. HTTP通信使用的报文格式
5. 底层TCP网络传输
6. 不同的HTTP协议变体
7. 因特网上安装的大量HTTP架构组件的一部分

### HTTP
HTTP,Hypertext Transfer Protocol,超文本传输协议,是在万维网上进行通信所使用的协议方案.HTTP有很多应用,但最著名的是用于web浏览器和web服务器(相关的web应用程序)之间的**双工通信**

HTTP使用的是可靠的数据传输协议,因此即使数据来自地球的另一端,它也能确保数据在传输过程中不会被损坏或产生混乱.

### web客户端和服务器
Web内容都是存储在Web服务器上的。Web服务器所使用的是HTTP协议，因此经常会被称为HTTP服务器。这些HTTP 服务器存储了因特网中的数据，如果HTTP 客户端发出请求的话，它们会提供数据。客户端向服务器发送HTTP 请求，服务器会在HTTP 响应中回送所请求的数据.HTTP 客户端和HTTP服务器共同构成了万维网的基本组件。

![clientAndServer](https://s1.ax1x.com/2020/09/08/wQqBY4.png)

浏览一个页面时http://www.oreilly.com/index.html， 浏览器会向服务器www.oreilly.com发送一条HTTP 请求（参见图1-1）。服务器会去寻找所期望的对象（在这个例子中就是/index.html），如果成功，就将对象、对象类型、对象长度以及其他一些信息放在HTTP 响应中发送给客户端。

### 资源

Web 服务器是Web 资源（Web resource）的宿主。Web 资源是Web 内容的源头。最简单的Web 资源就是Web 服务器文件系统中的静态文件。这些文件可以包含任意内容：文本文件、HTML 文件、微软的Word 文件、Adobe 的Acrobat 文件、JPEG 图片文件、AVI 电影文件，或所有其他你能够想到的格式。

但资源不一定非得是静态文件。资源还可以是根据需要生成内容的软件程序。这些动态内容资源可以根据你的身份、所请求的信息或每天的不同时段来产生内容。它们可以为你显示照相机中活生生的照片，也可以帮你进行股票交易，搜索房产数据库，或者从在线商店中购买礼物.

[![w3X3xe.png](https://s1.ax1x.com/2020/09/09/w3X3xe.png)](https://imgchr.com/i/w3X3xe)

图中的网关可以理解为该站点的IP地址,通过网关中的程序,用户可以使用站点的各种服务.

总之，所有类型的内容来源都是资源。包含公司销售预测电子表格的文件是一种资
源。扫描本地公共图书馆书架的Web 网关是一种资源。因特网搜索引擎也是一种
资源。

#### 媒体类型

因特网上有数千种不同的数据类型，HTTP 仔细地给每种要通过Web 传输的对象都打上了名为MIME 类型（MIME type） 的数据格式标签。最初设计MIME（Multipurpose Internet Mail Extension，多用途因特网邮件扩展）是为了决在不同的电子邮件系统之间搬移报文时存在的问题。MIME 在电子邮件系统中工作得非常好，因此HTTP 也采纳了它，用它来描述并标记多媒体内容。

Web 服务器会为所有HTTP 对象数据附加一个MIME 类型（参见图1-3）。当Web浏览器从服务器中取回一个对象时，会去查看相关的MIME 类型，看看它是否知道应该如何处理这个对象。大多数浏览器都可以处理数百种常见的对象类型：显示图片文件、解析并格式化HTML 文件、通过计算机声卡播放音频文件，或者运行外部插件软件来处理特殊格式的数据。

[![w3xVKg.png](https://s1.ax1x.com/2020/09/09/w3xVKg.png)](https://imgchr.com/i/w3xVKg)

MIME 类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。如:

• HTML 格式的文本文档由text/html 类型来标记。
• 普通的ASCII 文本文档由text/plain 类型来标记。
• JPEG 格式的图片为image/jpeg 类型。
• GIF 格式的图片为image/gif 类型。

#### URI

每个Web 服务器资源都有一个名字，这样客户端就可以说明它们感兴趣的资源是什么了。服务器资源名被称为统一资源标识符（Uniform Resource Identifier，URI）。URI 就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源。

给定了URI，HTTP 就可以解析出对象。URI 有两种形式，分别称为URL 和URN。

#### URL

统一资源定位符（URL）是资源标识符最常见的形式。URL 描述了一台特定服务器上某资源的特定位置。它们可以明确说明如何从一个精确、固定的位置获取资源。

图1-4 显示了URL 如何精确地说明某资源的位置以及如何去访问它。

[![w3z6pV.png](https://s1.ax1x.com/2020/09/09/w3z6pV.png)](https://imgchr.com/i/w3z6pV)

表1-1中的URL实例提供说明:

[![w8SZAs.png](https://s1.ax1x.com/2020/09/09/w8SZAs.png)](https://imgchr.com/i/w8SZAs)

大部分URL 都遵循一种标准格式，这种格式包含三个部分.

URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。这
部分通常就是HTTP 协议（http://）
第二部分给出了服务器的因特网地址（比如，www.abc.com）
其余部分指定了Web 服务器上的某个资源（比如，/specials/saw-blade.gif）

#### URN

URI 的第二种形式就是统一资源名（URN）。URN 是作为特定内容的唯一名称使用的，与目前的资源所在地无关。使用这些与位置无关的URN，就可以将资源四处搬移。通过URN，还可以用同一个名字通过多种网络访问协议来访问资源。

URN 仍然处于试验阶段. 因此我们大多在讨论的是URL,只会少部分涉及到URN

### 事务

一个HTTP 事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为HTTP 报文（HTTP message）的格式化数据块进行的，如图1-5

![wJq0cF.png](https://s1.ax1x.com/2020/09/10/wJq0cF.png)

#### 方法

HTTP 支持几种不同的请求命令，这些命令被称为HTTP 方法（HTTP method）。每条HTTP 请求报文都包含一个方法。这个方法会告诉服务器要执行什么动作（获取一个Web 页面、运行一个网关程序、删除一个文件等）。表1-2 列出了五种常见的HTTP 方法。

![wJO9MD.png](https://s1.ax1x.com/2020/09/10/wJO9MD.png)

#### 状态码

每条HTTP 响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码，告知客户端请求是否成功，或者是否需要采取其他动作。表1-3 显示了几种常见的状态码。

![wJXq41.png](https://s1.ax1x.com/2020/09/10/wJXq41.png)

伴随着每个数字状态码，HTTP 还会发送一条解释性的“原因短语”文本（参见图1-5 中的响应报文）。包含文本短语主要是为了进行描述，所有的处理过程使用的都是数字码。HTTP只处理数字码,与原因短语无关.

#### WEB页面可以包含多个对象

应用程序完成一项任务时通常会发布多个HTTP 事务。比如，Web 浏览器会发布一系列HTTP 事务来获取并显示一个包含了丰富图片的Web 页面。浏览器会执行一个事务来获取描述页面布局的HTML“框架”，然后发布另外的HTTP 事务来获取每个嵌入式图片、图像面板、Java 小程序等。这些嵌入式资源甚至可能位于不同的服务器上.因此，一个“Web 页面”通常并不是单个资源，而是一组资源的集合。

![wJjBP1.png](https://s1.ax1x.com/2020/09/10/wJjBP1.png)

### 报文

HTTP 报文是由一行一行的简单字符串组成的。HTTP 报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写.图1-7 显示了一个简单事务所使用的HTTP 报文。

![wNRt8H.png](https://s1.ax1x.com/2020/09/11/wNRt8H.png)

从Web 客户端发往Web 服务器的HTTP 报文称为请求报文（request message）。从服务器发往客户端的报文称为响应报文（response message），此外没有其他类型的HTTP 报文。HTTP 请求和响应报文的格式很类似。

HTTP 报文包括以下三个部分:
起始行:报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。
首部字段:起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为了便于解析，两者之间用冒号（:）来分隔。首部以一个空行结束。添加一个首部字段和添加新行一样简单。
主体:空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给Web 服务器的数据；响应主体中装载了要返回给客户端的数据。起始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意的二进制数据（比如图片、视频、音轨、软件程序）

图1-8 显示了可能会作为某个简单事务的一部分发送的HTTP 报文。
![wNWCJe.png](https://s1.ax1x.com/2020/09/11/wNWCJe.png)

在图1-8 中，浏览器发送了一条HTTP 请求报文。这条请求的起始行中有一个GET命令，且请求的资源为/tools.html。这条请求说明它使用的是1.0 版的HTTP 协议。请求报文没有主体，因为从服务器上GET 一个简单的文档不需要请求数据。

服务器会回送一条HTTP 响应报文。这条响应中包含了HTTP 的版本号（HTTP/1.0）、一个成功状态码（200）、一个描述性的原因短语（OK）， 以及一块响应首部字段，在所有这些内容之后跟着包含了所请求文档的响应主体。Content-Length首部说明了响应主体的长度，Content-Type 首部说明了文档的MIME 类型。

### 连接

报文是如何通过传输控制协议（Transmission Control Protocol，TCP）连接从一个地方搬移到另一个地方去的?

#### TCP/IP

HTTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议TCP/IP。